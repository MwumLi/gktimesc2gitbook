#!/usr/bin/env node

const program = require('commander');
const pkg = require('../package.json');
const Config = require('../lib/config');

program.on('--help', () => {
  console.log('\n**æ³¨æ„**: æœ¬è„šæœ¬åªæ˜¯ç©ä¹ä¹‹ä½œ, è¯·ä¸è¦ç”¨æ¥ä½œæ¶ğŸ‘» , æ”¯æŒä»˜è´¹é˜…è¯» ')
});

program
  .version(pkg.version)
  .description(pkg.description)
  .usage('[json config file] [options]')
  .option('--cid <id>', 'æå®¢æ—¶é—´ä¸“æ  id', '')
  .option('-c, --cookie <cookie string>', 'ç™»å½•æå®¢æ—¶é—´åæµè§ˆå™¨çš„ cookie, ç”¨äºé€šè¿‡è´­ä¹°çš„ä¸“æ è®¤è¯')
  .option('-g, --gitbook <dir>', 'ä¸“æ å¯¼å‡ºå­˜æ”¾ç›®å½•, é»˜è®¤å½“å‰è¿è¡Œå‘½ä»¤çš„ç›®å½•ä¸‹ gitbook/')
  .option('-r, --rate <ms>', "è¯·æ±‚é€Ÿç‡æ§åˆ¶, é—´éš”æŒ‡å®š ms æ•°è¯·æ±‚é¿å…æœåŠ¡å™¨è®¤ä¸ºä½ æ­£åœ¨æ”»å‡», é»˜è®¤ 500ms")
  .option('--retry <retry times>', "è§¦å‘æœåŠ¡å™¨è¯·æ±‚é¢‘ç‡é™åˆ¶é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤1æ¬¡ä¸é‡è¯•", 1)
  .option('--delay <s>', "é‡è¯•å»¶è¿Ÿï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’", 10)
  .option('-d, --debug', 'è°ƒè¯•æ¨¡å¼')
  .parse(process.argv);


if (program.args.length || Config.existsConfig(program)) {
  let configFile = program.args[0];
  if (program.config) {
    configFile = program.config;
  }

  const fileConfig = configFile ? Config.readConfig(configFile) : {};
  const config = Config.parseConfig(fileConfig, program);
  require('../lib')(config);

} else {
  program.help();
}


